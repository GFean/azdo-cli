# azdo-cli

A developer-friendly CLI for triggering **Azure DevOps pipelines** with an interactive, guided workflow.

Built by **gfean**.

> ⚠️ **Unofficial tool** — not affiliated with or endorsed by Microsoft.  
> Uses **user-provided Azure DevOps Personal Access Tokens (PATs)** only.

---

## What is azdo-cli?

Azure DevOps pipelines are powerful, but triggering them through the web UI can be slow and repetitive.

**azdo-cli** lets you:
- Trigger pipelines directly from the terminal
- Select pipelines and branches interactively
- Fill in pipeline parameters with guided prompts
- Run builds without memorizing pipeline IDs
- Keep secrets local (no remote storage, no telemetry)

It’s designed to feel **interactive when you want guidance**, and **scriptable when you don’t**.

---

## Commands at a glance

| Command | Purpose |
|------|--------|
| `azdo init` | Set up project configuration |
| `azdo build` | Interactive, guided pipeline run |
| `azdo run` | Trigger a specific pipeline by ID |

**Rule of thumb**
- Use **`build`** when you want to *choose* what to run
- Use **`run`** when you *already know* the pipeline ID

---

## Requirements

- **Node.js 18+** (uses built-in `fetch`)
- **Git** (used for branch discovery)
- Azure DevOps access
- A **Personal Access Token (PAT)** with permission to list and run pipelines

---

## Installation

### npm
```bash
npm install --save-dev azdo-cli
```

### yarn

```bash
yarn add --dev azdo-cli
```

Run using:

```bash
npx azdo --help
# or
yarn azdo --help
```

---

## Quick start

### 1️⃣ Create a `.env` file

```env
AZDO_ORG_URL=https://dev.azure.com/your-organization
AZDO_PROJECT=Your Project Name
AZDO_PAT=your_personal_access_token
```

> Treat your PAT like a password.
> `.env` files should not be committed.

---

### 2️⃣ Initialize azdo-cli

```bash
npx azdo init
# or
yarn azdo init
```

This will:

* Create `azdo.config.json` in your repo
* Discover available pipelines
* Optionally store your PAT locally

---

### 3️⃣ Run a pipeline interactively

```bash
npx azdo build
# or
yarn azdo build
```

You’ll be guided through:

* Selecting a pipeline
* Choosing a branch
* Entering pipeline parameters
* Optionally waiting for completion

---

## Configuration

### Environment variables (required)

| Variable       | Description                   |
| -------------- | ----------------------------- |
| `AZDO_ORG_URL` | Azure DevOps organization URL |
| `AZDO_PROJECT` | Exact project name            |
| `AZDO_PAT`     | Personal Access Token         |

Environment files are loaded in this order:

1. `.env`
2. `.env.internal` (overrides `.env`)

---

### `azdo.config.json`

Generated by `azdo init`.
This file defines how azdo-cli understands your project.

Example:

```json
{
  "orgUrl": "https://dev.azure.com/your-organization",
  "project": "Your Project Name",
  "auth": { "patEnv": "AZDO_PAT" },
  "defaults": { "branch": "develop", "pollMs": 7000 },
  "pipelines": {
    "staging_build": {
      "id": 12,
      "name": "Staging Build"
    },
    "production_build": {
      "id": 15,
      "name": "Production Build",
      "branch": "main"
    }
  }
}
```

**Notes**

* Pipeline keys are friendly aliases
* `branch` overrides the default branch for that pipeline
* YAML paths can be pinned if parameter discovery is needed

---

## `azdo build`

**Interactive pipeline runner.**

Use this when you want guidance and don’t want to remember pipeline IDs.

```bash
npx azdo build
```

### Common options

* `--pipeline <id|key>` – select pipeline by ID or config key
* `--branch <name>` – override branch
* `--param <key=value>` – repeatable parameter overrides
* `--no-prompt` – skip interactive prompts
* `--no-wait` – trigger and exit immediately
* `--poll <ms>` – polling interval

### Examples

```bash
npx azdo build
npx azdo build --pipeline staging_build
npx azdo build --branch develop
npx azdo build --param releaseNotes="Release candidate build"
npx azdo build --no-prompt --branch main
```

---

## `azdo run`

**Direct pipeline trigger by ID.**

Use this when:

* scripting
* automating
* running one-off builds

```bash
npx azdo run --pipeline <pipeline_id>
```

### Options

* `--pipeline <id>` (required)
* `--branch <name>`
* `--param <key=value>` (repeatable)
* `--no-wait`
* `--poll <ms>`

### Examples

```bash
npx azdo run --pipeline 42
npx azdo run --pipeline 42 --branch main
npx azdo run --pipeline 42 --param releaseNotes="Hotfix build"
```

---

## Parameter handling

azdo-cli supports multiple ways to pass parameters:

```bash
--param key=value
--flag value
--flag=value
--no-flag
```

Rules:

* Flags are converted to parameters automatically
* `--no-flag` sets a boolean parameter to `false`
* Last value wins
* Values are parsed as:

  * `true` / `false` → boolean
  * numbers → number
  * everything else → string

Use quotes for values with spaces:

```bash
--releaseNotes "Initial beta release"
```

---

## Exit codes

| Code | Meaning                           |
| ---- | --------------------------------- |
| `0`  | Pipeline succeeded                |
| `1`  | Error or pipeline did not succeed |

---

## Security & design principles

* Tokens stay **local**
* No telemetry
* No background services
* No vendor lock-in
* Everything is transparent and inspectable

---

## Author

Built and maintained by **gfean**.
